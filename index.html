<script>
  const pares = ["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT", /* etc */];
  const domingo = { /* tus valores */ };
  const proxy = url => 'https://thingproxy.freeboard.io/fetch/' + url;
  let dataGlobal = [], alerted = new Set();

  async function actualizar() {
    const resultados = [];
    for (let par of pares) {
      try {
        const precioRes = await fetch(proxy(`https://api.binance.com/api/v3/ticker/price?symbol=${par}`));
        const { price } = await precioRes.json();
        const precio = parseFloat(price);
        const klRes = await fetch(proxy(`https://api.binance.com/api/v3/klines?symbol=${par}&interval=1h&limit=15`));
        const kl = await klRes.json();
        const cierres = kl.map(k => parseFloat(k[4]));
        const ema = calcEMA(cierres, 28);
        const rsi = calcRSI(cierres);
        const { max, min } = domingo[par] || {};
        let score = 0;
        if (precio > min) score += 1;
        if (precio > (min + max)/2) score += 2;
        if (precio > max) score += 2;
        if (precio < min) score += 2;
        if ((precio % 1) < 0.2) score += 1;
        if (precio > ema) score += 2;
        if (rsi > 60 || rsi < 40) score += 2.5;
        score = Math.min(10, Math.max(1, score));
        const alerta = score >= 7 ? `üö® ${par.replace('USDT','')} √çndice ${score}` : '-';
        resultados.push({ cripto: par.replace('USDT',''), precio, indice: score, alerta });
      } catch(e) {
        console.warn('Error con', par, e);
      }
    }
    dataGlobal = resultados;
    renderTabla();
    mostrarAlerta();
  }

  function calcEMA(vals, p) {
    const k = 2/(p+1);
    return vals.reduce((a,v,i)=> i? v*k + a*(1-k) : v, 0);
  }
  function calcRSI(c) {
    let gains=0, losses=0;
    for (let i=1; i<c.length; i++) {
      const d = c[i] - c[i-1];
      if (d>0) gains+=d; else losses-=d;
    }
    const avgG = gains/(c.length-1), avgL = losses/(c.length-1) || 1e-6;
    const rs = avgG/avgL;
    return 100 - (100/(1+rs));
  }

  function renderTabla() { /* tu c√≥digo existente para pintar #panel */ }
  function mostrarAlerta() { /* tu c√≥digo existente para #alerta */ }

  document.getElementById('buscar').addEventListener('input', renderTabla);
  document.getElementById('orden').addEventListener('change', renderTabla);

  actualizar();
  setInterval(actualizar, 30000);
</script>
